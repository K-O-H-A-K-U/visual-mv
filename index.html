<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Contrail+One" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/89/three.min.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/controls/OrbitControls.js"></script>
    <title>LoudRock</title>
</head>
<body id="DropFrame" ondragover="handleDragOver(event);" ondrop="execDrop(event);">
    
    <div class="audios">
        <img id="mplaypause" src="img/Orion_play.png" alt="再生・一時停止" width="40">
        <label for="trigger" class="open_button">
            <img id="sdcld" src="img/Soundcloud.png" alt="サウンドクラウドから曲を探す" width="40">
        </label>
        <audio id="usermusic" preload="auto" loop></audio>
    </div>

    <div class="modal_wrap">
        <input id="trigger" type="checkbox">
        <div class="modal_overlay">
            <label for="trigger" class="modal_trigger"></label>
            <div class="modal_content">
                <label for="trigger" class="close_button">✖️</label>
                <h2>Play Audio via Soundcloud</h2>
                <input id="sc_url" placeholder="e.g. https://soudcloud.com/...">
                <button id= "sc_send">IMPORT</button>
            </div>
        </div>
    </div>

    <section id="lp">
        <div class="lpimg">
            <img src="img/lpimg.jpg" alt="lpimg">
        </div>
    </section>
    <section id="cap">
        <div class="lpdesc">
            <p class="title">You Are Listening To</p>
            <p class="artist">- <span id="output">LoudRock</span> -</p>
            <p class="title">This is Awesome</p>
            <div class="canbox">
                <canvas id="visualizer" width="640"></canvas>
            </div>
        </div>

    </section>

    <canvas id="myCanvas"></canvas>

    <script>
      window.addEventListener('load', init);

      function init(){
        // Canvas未サポート対応
        if (!window.HTMLCanvasElement) return;
        
        // サイズを指定
        const width = window.innerWidth;
        const height = window.innerHeight;

        function random(min, max) {
            let ans = Math.floor((min + (max - min + 1) * Math.random()));
            return ans;
        }

        // レンダラーを作成
        const renderer = new THREE.WebGLRenderer({
          alpha: true,
          canvas: document.querySelector('#myCanvas')
        });
        
        renderer.setClearAlpha(0);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(width, height);

        // シーンを作成
        const scene = new THREE.Scene();

        // カメラを作成
        const camera = new THREE.PerspectiveCamera(70, width / height, 1, 6000);
        camera.position.set(0, 300, 2500);
        camera.lookAt(scene.position);
        
        //ガイド線
        // var gridHelper = new THREE.GridHelper(width, 5); // サイズ, 分割数
        // scene.add(gridHelper);
        
        // var axisHelper = new THREE.AxisHelper(width); // サイズ
        // scene.add(axisHelper);

        // コントロールカメラ
        // var controlCamera = new THREE.PerspectiveCamera(35, width / height, 1, 6000);
        // controlCamera.position.set(0, 500, 1600);
        // var controls = new THREE.OrbitControls(controlCamera);

        const X_SIZE = window.innerWidth;
        const Y_SIZE = window.innerHeight;
        const LENGTH = 50;
        const PLANE_SCALE = 5;

        var plane = [];

        for(var i=0; i<LENGTH; i++){

            var geometry = new THREE.PlaneGeometry( PLANE_SCALE, PLANE_SCALE );
            var material = new THREE.MeshBasicMaterial({
                color: 'white', 
                side: THREE.DoubleSide, 
                opacity: 0.7,
                transparent: true
                });
            plane[i] = new THREE.Mesh( geometry, material );

            plane[i].position.x = X_SIZE * (Math.random() - 0.5);
            plane[i].position.y = Y_SIZE * (Math.random());
            plane[i].position.z = X_SIZE * (Math.random() - 0.5);

            scene.add( plane[i] );

        }

        function random(min, max) {
            let rand = Math.floor((min + (max - min + 1) * Math.random()));
            return rand;
        }

        // レンダリング処理
        // function render() {
        //     controls.update();
        //     renderer.render(scene, controlCamera);
        // }

        let rot = 0; // 角度
        let mouseX = 0; // マウス座標

        // マウス座標はマウスが動いた時のみ取得できる
        document.addEventListener("mousemove", (event) => {mouseX = event.pageX;});

        tick();

        // 毎フレーム時に実行されるループイベントです
        function tick() {

            const targetRot = (mouseX / window.innerWidth) * 360;
            rot += (targetRot - rot) * 0.01;
            const radian = rot * Math.PI / 180;
            // 角度に応じてカメラの位置を設定
            camera.position.x = 1000 * Math.sin(radian);
            camera.position.z = 1000 * Math.cos(radian);
            // 原点方向を見つめる
            camera.lookAt(new THREE.Vector3(0, 0, 0));

            for(var i=0; i<LENGTH; i++){
                plane[i].rotation.y += (Math.random()*0.1);
                plane[i].rotation.x += (Math.random()*0.1);
                plane[i].rotation.z += (Math.random()*0.1);

                plane[i].position.x += (random(-5, 5)*0.1);
                plane[i].position.y += 2.5;
                plane[i].position.z += (random(-5, 5)*0.1);

                if (plane[i].position.y > height) {
                    plane[i].position.x = X_SIZE * (Math.random() - 0.5);
                    plane[i].position.y = -200;
                    plane[i].position.z = X_SIZE * (Math.random() - 0.5);
                }
            }
  
            renderer.render(scene, camera);

            requestAnimationFrame(tick);
            //render();
        }

      }
    </script>
    <script src="js/custom.js"></script>
</body>
</html>