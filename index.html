<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="Reproduction visual-music videos by Three.js at web">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Contrail+One" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/89/three.min.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/controls/OrbitControls.js"></script>
    <title>particle music playerüåü</title>
</head>
<body id="DropFrame" ondragover="handleDragOver(event);" ondrop="execDrop(event);">
    
    <div class="audios">
        <label for="trigger" class="open_button">
            <img id="sptfy" src="img/Spotify.png" alt="Spotify„Åã„ÇâÊõ≤„ÇíÂÜçÁîü„Åô„Çã" width="40">
        </label>
        <img id="mplaypause" src="img/Orion_play.png" alt="ÂÜçÁîü„Éª‰∏ÄÊôÇÂÅúÊ≠¢" width="40">
        <audio id="usermusic" preload="auto" loop></audio>
    </div>

    <div class="modal_wrap">
        <input id="trigger" type="checkbox">
        <div class="modal_overlay">
            <label for="trigger" class="modal_trigger"></label>
            <div class="modal_content">
                <label for="trigger" class="close_button">‚úñÔ∏è</label>
                <h2>Play Audio via Spotify</h2>
                <input id="sp_url" placeholder="e.g. https://open.spotify.com/track/„Éª„Éª„Éª">
                <button id= "sp_btn">IMPORT</button>
            </div>
        </div>
    </div>

    <section id="lp">
        <div class="lpimg">
            <img id="lpimg" src="img/lpimg.jpg" alt="lpimg">
        </div>
    </section>
    <section id="cap">
        <div class="lpdesc">
            <p class="title">You Are Listening To</p>
            <p class="artist">- <span id="output">LoudRock</span> -</p>
            <p class="title">This is awesome song</p>
            <div class="canbox">
                <canvas id="visualizer" width="640"></canvas>
            </div>
        </div>

    </section>

    <canvas id="myCanvas"></canvas>

    <script>
      window.addEventListener('load', init);

      const random = (min, max) => {
          return Math.floor((min + (max - min + 1) * Math.random()));
      }

      function init(){
        // CanvasÊú™„Çµ„Éù„Éº„ÉàÂØæÂøú
        if (!window.HTMLCanvasElement) return;
        
        // „Çµ„Ç§„Ç∫„ÇíÊåáÂÆö
        const width = window.innerWidth;
        const height = window.innerHeight;

        // „É¨„É≥„ÉÄ„É©„Éº„Çí‰ΩúÊàê
        const renderer = new THREE.WebGLRenderer({
          alpha: true,
          canvas: document.querySelector('#myCanvas')
        });
        
        renderer.setClearAlpha(0);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(width, height);

        // „Ç∑„Éº„É≥„Çí‰ΩúÊàê
        const scene = new THREE.Scene();

        // „Ç´„É°„É©„Çí‰ΩúÊàê
        const camera = new THREE.PerspectiveCamera(70, width / height, 1, 1000);
        camera.position.set(0, 300, 2500);
        camera.lookAt(scene.position);

        const X_SIZE = window.innerWidth;
        const Y_SIZE = window.innerHeight;
        const LENGTH = 100;
        const PLANE_SCALE = 5;

        const plane = [];

        const geometry = new THREE.PlaneGeometry( PLANE_SCALE, PLANE_SCALE );
        const material = new THREE.MeshBasicMaterial({
            color: 'white', 
            side: THREE.DoubleSide, 
            opacity: 0.7,
            transparent: true
        });

        for(let i=0; i<LENGTH; i++){

            plane[i] = new THREE.Mesh( geometry, material );

            plane[i].position.x = X_SIZE * (Math.random() - 0.5);
            plane[i].position.y = Y_SIZE * (Math.random());
            plane[i].position.z = X_SIZE * (Math.random() - 0.5);

            scene.add( plane[i] );
        }

        let rot = 0; 
        let mouseX = 0; 
        let Posi = 0;

        document.addEventListener("mousemove", (event) => {mouseX = event.pageX;});

        tick();

        if(navigator.userAgent.match(/(iPhone|iPad|iPod|Android)/i)){
            Posi = 500;
        }else{
            Posi = 800;
        }

        function tick() {

            const targetRot = (mouseX / window.innerWidth) * 360;
            rot += (targetRot - rot) * 0.01;
            const radian = rot * Math.PI / 180;
            
            camera.position.x = Posi * Math.sin(radian);
            camera.position.z = Posi * Math.cos(radian);
            
            camera.lookAt(new THREE.Vector3(0, 0, 0));

            for(let i=0; i<LENGTH; i++){
                plane[i].rotation.y += (Math.random()*0.1);
                plane[i].rotation.x += (Math.random()*0.1);
                plane[i].rotation.z += (Math.random()*0.1);

                plane[i].position.x += (random(-5, 5)*0.1);
                plane[i].position.y += 2.5;
                plane[i].position.z += (random(-5, 5)*0.1);

                if (plane[i].position.y > height) {
                    plane[i].position.x = X_SIZE * (Math.random() - 0.5);
                    plane[i].position.y = -200;
                    plane[i].position.z = X_SIZE * (Math.random() - 0.5);
                }
            }
  
            renderer.render(scene, camera);

            requestAnimationFrame(tick);
        }

      }
    </script>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script src="js/rgbaster.js"></script>
    <script src="js/custom.js"></script>
</body>
</html>